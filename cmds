-- üî• Firefly Commands UI - Fixed Version
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

-- ‡∏•‡∏ö UI ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô
if player.PlayerGui:FindFirstChild("FireflyCommandsUI") then
    player.PlayerGui:FindFirstChild("FireflyCommandsUI"):Destroy()
end

-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
local isFollowing = false
local followTarget = nil
local stopAllActions = false
local isFirefliesVisible = true
local followConnection = nil
local spawnPoint = nil
local isAutoRespawnEnabled = false

-- ========== ‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡∏°‡πà ==========
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FireflyCommandsUI"
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- ========== SECRET UI (‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢ !cmdfirefly) ==========
local secretFrame = Instance.new("Frame")
secretFrame.Size = UDim2.new(0, 340, 0, 420)
secretFrame.Position = UDim2.new(0.5, -170, 0.5, -210)
secretFrame.BackgroundColor3 = Color3.fromRGB(15, 20, 30)
secretFrame.BorderSizePixel = 0
secretFrame.Visible = false
secretFrame.Parent = screenGui

local secretCorner = Instance.new("UICorner")
secretCorner.CornerRadius = UDim.new(0, 8)
secretCorner.Parent = secretFrame

-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
local secretHeader = Instance.new("Frame")
secretHeader.Size = UDim2.new(1, 0, 0, 50)
secretHeader.BackgroundColor3 = Color3.fromRGB(25, 35, 50)
secretHeader.BorderSizePixel = 0
secretHeader.Active = true
secretHeader.Parent = secretFrame

local secretHeaderCorner = Instance.new("UICorner")
secretHeaderCorner.CornerRadius = UDim.new(0, 8)
secretHeaderCorner.Parent = secretHeader

local secretTitle = Instance.new("TextLabel")
secretTitle.Text = "‚ö° FIREFLY COMMANDS FIXED"
secretTitle.Size = UDim2.new(1, -70, 1, 0)
secretTitle.Position = UDim2.new(0, 10, 0, 0)
secretTitle.BackgroundTransparency = 1
secretTitle.TextColor3 = Color3.fromRGB(255, 200, 100)
secretTitle.TextSize = 16
secretTitle.Font = Enum.Font.GothamBold
secretTitle.Parent = secretHeader

local secretCloseBtn = Instance.new("TextButton")
secretCloseBtn.Text = "√ó"
secretCloseBtn.Size = UDim2.new(0, 30, 0, 30)
secretCloseBtn.Position = UDim2.new(1, -35, 0.5, -15)
secretCloseBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
secretCloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
secretCloseBtn.TextSize = 18
secretCloseBtn.Font = Enum.Font.GothamBold
secretCloseBtn.Parent = secretHeader

local secretBtnCorner = Instance.new("UICorner")
secretBtnCorner.CornerRadius = UDim.new(0, 6)
secretBtnCorner.Parent = secretCloseBtn

-- Content
local secretContent = Instance.new("ScrollingFrame")
secretContent.Size = UDim2.new(1, -20, 0, 320)
secretContent.Position = UDim2.new(0, 10, 0, 60)
secretContent.BackgroundTransparency = 1
secretContent.BorderSizePixel = 0
secretContent.ScrollBarThickness = 4
secretContent.ScrollBarImageColor3 = Color3.fromRGB(80, 90, 110)
secretContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
secretContent.Parent = secretFrame

local secretLayout = Instance.new("UIListLayout")
secretLayout.Padding = UDim.new(0, 8)
secretLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
secretLayout.Parent = secretContent

-- Status
local secretStatus = Instance.new("Frame")
secretStatus.Size = UDim2.new(1, -20, 0, 35)
secretStatus.Position = UDim2.new(0, 10, 1, -40)
secretStatus.BackgroundColor3 = Color3.fromRGB(25, 35, 50)
secretStatus.Parent = secretFrame

local secretStatusCorner = Instance.new("UICorner")
secretStatusCorner.CornerRadius = UDim.new(0, 6)
secretStatusCorner.Parent = secretStatus

local secretStatusText = Instance.new("TextLabel")
secretStatusText.Text = "‚ö° ‡∏û‡∏¥‡∏°‡∏û‡πå !cmdfirefly ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î UI ‡∏ô‡∏µ‡πâ"
secretStatusText.Size = UDim2.new(1, -10, 1, 0)
secretStatusText.Position = UDim2.new(0, 5, 0, 0)
secretStatusText.BackgroundTransparency = 1
secretStatusText.TextColor3 = Color3.fromRGB(255, 200, 100)
secretStatusText.TextSize = 11
secretStatusText.Font = Enum.Font.Gotham
secretStatusText.TextXAlignment = Enum.TextXAlignment.Left
secretStatusText.Parent = secretStatus

-- ========== ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ==========
local secretCommands = {
    {name = "!tp [‡∏ä‡∏∑‡πà‡∏≠]", desc = "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (FIXED)", example = "!tp Player1", color = Color3.fromRGB(100, 150, 255)},
    {name = "!tps", desc = "‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°", example = "!tps", color = Color3.fromRGB(255, 100, 100)},
    {name = "!copy [‡∏ä‡∏∑‡πà‡∏≠]", desc = "‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏ä‡∏∏‡∏î‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (FIXED)", example = "!copy P1", color = Color3.fromRGB(50, 200, 150)},
    {name = "!firefly [‡∏à‡∏≥‡∏ô‡∏ß‡∏ô]", desc = "‡πÄ‡∏™‡∏Å Firefly ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (FIXED)", example = "!firefly 1000", color = Color3.fromRGB(0, 150, 80)},
    {name = "!goto [‡∏ä‡∏∑‡πà‡∏≠]", desc = "‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô", example = "!goto Player1", color = Color3.fromRGB(70, 130, 200)},
    {name = "!ns", desc = "‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô Firefly (FIXED)", example = "!ns", color = Color3.fromRGB(200, 50, 50)},
    {name = "!s", desc = "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô Firefly (FIXED)", example = "!s", color = Color3.fromRGB(50, 200, 50)},
    {name = "!fireflyclear", desc = "‡∏•‡πâ‡∏≤‡∏á Firefly ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", example = "!fireflyclear", color = Color3.fromRGB(200, 60, 60)},
    {name = "!sa", desc = "‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", example = "!sa", color = Color3.fromRGB(255, 150, 50)}
}

-- ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î ==========
local function createCard(cmd)
    local card = Instance.new("Frame")
    card.Size = UDim2.new(0.95, 0, 0, 70)
    card.BackgroundColor3 = Color3.fromRGB(30, 40, 50)
    card.BorderSizePixel = 0
    
    local cardCorner = Instance.new("UICorner")
    cardCorner.CornerRadius = UDim.new(0, 6)
    cardCorner.Parent = card
    
    local colorBar = Instance.new("Frame")
    colorBar.Size = UDim2.new(1, 0, 0, 3)
    colorBar.BackgroundColor3 = cmd.color or Color3.fromRGB(100, 100, 100)
    colorBar.BorderSizePixel = 0
    colorBar.Parent = card
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Text = cmd.name
    nameLabel.Size = UDim2.new(1, -10, 0, 25)
    nameLabel.Position = UDim2.new(0, 5, 0, 5)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextSize = 13
    nameLabel.Font = Enum.Font.GothamSemibold
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = card
    
    local descLabel = Instance.new("TextLabel")
    descLabel.Text = cmd.desc
    descLabel.Size = UDim2.new(1, -10, 0, 20)
    descLabel.Position = UDim2.new(0, 5, 0, 30)
    descLabel.BackgroundTransparency = 1
    descLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    descLabel.TextSize = 11
    descLabel.Font = Enum.Font.Gotham
    descLabel.TextXAlignment = Enum.TextXAlignment.Left
    descLabel.Parent = card
    
    local exampleLabel = Instance.new("TextLabel")
    exampleLabel.Text = "üìù " .. cmd.example
    exampleLabel.Size = UDim2.new(1, -10, 0, 18)
    exampleLabel.Position = UDim2.new(0, 5, 0, 50)
    exampleLabel.BackgroundTransparency = 1
    exampleLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
    exampleLabel.TextSize = 10
    exampleLabel.Font = Enum.Font.Gotham
    exampleLabel.TextXAlignment = Enum.TextXAlignment.Left
    exampleLabel.Parent = card
    
    return card
end

-- ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡∏á UI
local function loadSecretCommands()
    secretContent:ClearAllChildren()
    for i, cmd in ipairs(secretCommands) do
        local card = createCard(cmd)
        card.Parent = secretContent
    end
end

-- ========== ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ==========
local function updateStatus(message)
    secretStatusText.Text = message
    
    if message:find("‚ùå") or message:find("‡πÑ‡∏°‡πà") or message:find("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß") then
        secretStatusText.TextColor3 = Color3.fromRGB(255, 100, 100)
    elseif message:find("‚úÖ") or message:find("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à") then
        secretStatusText.TextColor3 = Color3.fromRGB(100, 255, 100)
    elseif message:find("‚ö°") or message:find("üìç") or message:find("‡∏Å‡∏≥‡∏•‡∏±‡∏á") then
        secretStatusText.TextColor3 = Color3.fromRGB(255, 200, 100)
    else
        secretStatusText.TextColor3 = Color3.fromRGB(255, 220, 150)
    end
end

-- ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ==========
local function findPlayer(name)
    if not name or name == "" then return nil end
    
    for _, p in ipairs(Players:GetPlayers()) do
        if string.lower(p.Name) == string.lower(name) or 
           string.find(string.lower(p.Name), string.lower(name)) then
            return p
        end
    end
    return nil
end

-- ========== FIXED !tp COMMAND ==========
local function startFollowing(target)
    if not target or not target.Character then
        updateStatus("‚ùå ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ Character")
        return false
    end
    
    -- ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
    if followConnection then
        followConnection:Disconnect()
        followConnection = nil
    end
    
    isFollowing = true
    followTarget = target
    
    updateStatus("üìç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° " .. target.Name)
    
    -- ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    local myChar = player.Character
    if myChar and myChar:FindFirstChild("HumanoidRootPart") then
        local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
        if targetHRP then
            myChar.HumanoidRootPart.CFrame = targetHRP.CFrame + Vector3.new(0, 3, 0)
        end
    end
    
    -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
    followConnection = RunService.Heartbeat:Connect(function()
        if not isFollowing or not followTarget then
            if followConnection then
                followConnection:Disconnect()
                followConnection = nil
            end
            return
        end
        
        if stopAllActions then
            isFollowing = false
            if followConnection then
                followConnection:Disconnect()
                followConnection = nil
            end
            updateStatus("‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°")
            return
        end
        
        local myChar = player.Character
        if not myChar or not myChar:FindFirstChild("HumanoidRootPart") then
            return
        end
        
        if followTarget.Character and followTarget.Character:FindFirstChild("HumanoidRootPart") then
            local targetHRP = followTarget.Character.HumanoidRootPart
            local myHRP = myChar.HumanoidRootPart
            
            -- ‡πÉ‡∏ä‡πâ CFrame.lookAt ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
            local newCFrame = CFrame.lookAt(
                targetHRP.Position + Vector3.new(0, 3, 0),
                targetHRP.Position
            )
            
            -- Smooth teleport
            myHRP.CFrame = newCFrame
        end
    end)
    
    return true
end

local function stopFollowing()
    isFollowing = false
    followTarget = nil
    
    if followConnection then
        followConnection:Disconnect()
        followConnection = nil
    end
    
    updateStatus("‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°")
end

-- ========== FIXED !copy COMMAND ==========
local function copyOutfit(target)
    if not target or not target.Character then
        updateStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô")
        return false
    end
    
    local myChar = player.Character
    if not myChar then
        updateStatus("‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ Character")
        return false
    end
    
    -- ‡∏£‡∏≠‡πÉ‡∏´‡πâ Character ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
    if not myChar:FindFirstChild("Humanoid") then
        updateStatus("‚ùå ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠ Character...")
        return false
    end
    
    -- ‡∏•‡∏ö‡∏ä‡∏∏‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å
    for _, item in ipairs(myChar:GetChildren()) do
        if item:IsA("Accessory") then
            item:Destroy()
        end
    end
    
    -- ‡∏•‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤
    for _, item in ipairs(myChar:GetChildren()) do
        if item:IsA("Shirt") or item:IsA("Pants") then
            item:Destroy()
        end
    end
    
    -- ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà
    local copied = 0
    
    -- ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ Accessories
    for _, item in ipairs(target.Character:GetChildren()) do
        if item:IsA("Accessory") then
            local clone = item:Clone()
            clone.Parent = myChar
            copied = copied + 1
        end
    end
    
    -- ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤
    for _, item in ipairs(target.Character:GetChildren()) do
        if item:IsA("Shirt") then
            local clone = item:Clone()
            clone.Parent = myChar
            copied = copied + 1
        elseif item:IsA("Pants") then
            local clone = item:Clone()
            clone.Parent = myChar
            copied = copied + 1
        end
    end
    
    -- ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ Body Colors
    local targetHumanoid = target.Character:FindFirstChild("Humanoid")
    local myHumanoid = myChar:FindFirstChild("Humanoid")
    
    if targetHumanoid and myHumanoid then
        myHumanoid.BodyTypeScale.Value = targetHumanoid.BodyTypeScale.Value
        myHumanoid.DepthScale.Value = targetHumanoid.DepthScale.Value
        myHumanoid.HeadScale.Value = targetHumanoid.HeadScale.Value
        myHumanoid.HeightScale.Value = targetHumanoid.HeightScale.Value
        myHumanoid.ProportionScale.Value = targetHumanoid.ProportionScale.Value
        myHumanoid.WidthScale.Value = targetHumanoid.WidthScale.Value
    end
    
    updateStatus("üëï ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏ä‡∏∏‡∏î " .. copied .. " ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à")
    return true
end

-- ========== FIXED !firefly COMMAND ==========
local function spawnFireflies(count)
    if stopAllActions then 
        updateStatus("‚ùå ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")
        return false 
    end
    
    -- ‡∏´‡∏≤ Firefly tool
    local fireflies = player.Backpack:FindFirstChild("Fireflies") or 
                     player.Character:FindFirstChild("Fireflies")
    
    if not fireflies then
        updateStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö Fireflies Tool")
        return false
    end
    
    local remote = fireflies:FindFirstChild("RemoteEvent")
    if not remote then
        remote = fireflies:FindFirstChild("RemoteFunction")
    end
    
    if not remote then
        updateStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö RemoteEvent/RemoteFunction")
        return false
    end
    
    updateStatus("‚ö° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏Å " .. count .. " ‡∏ï‡∏±‡∏ß...")
    
    -- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏Å
    spawn(function()
        local successCount = 0
        local batchSize = 100  -- ‡∏™‡πà‡∏á‡∏ó‡∏µ‡∏•‡∏∞ 100 ‡∏ï‡∏±‡∏ß
        
        for i = 1, count do
            if stopAllActions then break end
            
            -- ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
            pcall(function()
                if remote:IsA("RemoteEvent") then
                    remote:FireServer()
                elseif remote:IsA("RemoteFunction") then
                    remote:InvokeServer()
                end
                successCount = successCount + 1
            end)
            
            -- ‡∏£‡∏≠‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏∏‡∏Å 100 ‡∏ï‡∏±‡∏ß
            if i % batchSize == 0 then
                updateStatus("‚ö° ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏Å... (" .. i .. "/" .. count .. ")")
                wait(0.05)
            end
        end
        
        if stopAllActions then
            updateStatus("‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà " .. successCount .. " ‡∏ï‡∏±‡∏ß")
        else
            updateStatus("‚úÖ ‡πÄ‡∏™‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à " .. successCount .. " ‡∏ï‡∏±‡∏ß!")
        end
    end)
    
    return true
end

-- ========== FIXED VISIBILITY COMMANDS ==========
local function setFirefliesVisibility(visible)
    local count = 0
    
    -- ‡∏´‡∏≤ Firefly ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Workspace
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and (obj.Name:find("Firefly") or obj.Name:find("firefly") or obj.Name:find("FF")) then
            if visible then
                obj.Transparency = 0
                if obj:FindFirstChildOfClass("ParticleEmitter") then
                    obj:FindFirstChildOfClass("ParticleEmitter").Enabled = true
                end
                if obj:FindFirstChild("PointLight") then
                    obj.PointLight.Enabled = true
                end
            else
                obj.Transparency = 1
                if obj:FindFirstChildOfClass("ParticleEmitter") then
                    obj:FindFirstChildOfClass("ParticleEmitter").Enabled = false
                end
                if obj:FindFirstChild("PointLight") then
                    obj.PointLight.Enabled = false
                end
            end
            count = count + 1
        end
    end
    
    if visible then
        updateStatus("üëÅÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô Firefly " .. count .. " ‡∏ï‡∏±‡∏ß")
    else
        updateStatus("üö´ ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô Firefly " .. count .. " ‡∏ï‡∏±‡∏ß")
    end
    
    isFirefliesVisible = visible
    return true
end

-- ========== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ==========
local function teleportTo(target)
    if not target or not target.Character then
        updateStatus("‚ùå ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ Character")
        return false
    end
    
    local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
    if not targetHRP then
        updateStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö HumanoidRootPart ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô")
        return false
    end
    
    local myChar = player.Character
    if not myChar then
        updateStatus("‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ Character")
        return false
    end
    
    local myHRP = myChar:FindFirstChild("HumanoidRootPart")
    if not myHRP then
        updateStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö HumanoidRootPart ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì")
        return false
    end
    
    myHRP.CFrame = targetHRP.CFrame + Vector3.new(0, 3, 0)
    updateStatus("üìç ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏´‡∏≤ " .. target.Name)
    return true
end

local function clearFireflies()
    local count = 0
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj.Name:find("Firefly") or obj.Name:find("firefly") or obj.Name:find("FF") then
            obj:Destroy()
            count = count + 1
        end
    end
    updateStatus("üßπ ‡∏•‡πâ‡∏≤‡∏á Firefly " .. count .. " ‡∏ï‡∏±‡∏ß")
end

local function stopAll()
    stopAllActions = true
    stopFollowing()
    updateStatus("‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")
    
    wait(2)
    stopAllActions = false
    updateStatus("‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô")
end

-- ========== Dragging System ==========
local secretDragging = false
local secretDragStart = Vector2.new(0, 0)
local secretStartPos = UDim2.new(0, 0, 0, 0)

secretHeader.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        secretDragging = true
        secretDragStart = Vector2.new(input.Position.X, input.Position.Y)
        secretStartPos = secretFrame.Position
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if secretDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - secretDragStart
        secretFrame.Position = UDim2.new(
            secretStartPos.X.Scale, secretStartPos.X.Offset + delta.X,
            secretStartPos.Y.Scale, secretStartPos.Y.Offset + delta.Y
        )
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        secretDragging = false
    end
end)

-- ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
secretCloseBtn.MouseButton1Click:Connect(function()
    secretFrame.Visible = false
end)

secretCloseBtn.MouseEnter:Connect(function()
    secretCloseBtn.BackgroundColor3 = Color3.fromRGB(220, 70, 70)
end)

secretCloseBtn.MouseLeave:Connect(function()
    secretCloseBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
end)

-- ========== ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏ä‡∏ó ==========
local function processChatCommand(message)
    local msg = string.lower(message)
    
    if string.sub(msg, 1, 1) ~= "!" then
        return
    end
    
    -- ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
    local parts = {}
    for part in string.gmatch(msg, "[^%s]+") do
        table.insert(parts, part)
    end
    
    if #parts == 0 then return end
    
    local command = string.sub(parts[1], 2)
    local param = parts[2] or ""
    
    -- ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î UI
    if command == "cmdfirefly" then
        secretFrame.Visible = not secretFrame.Visible
        if secretFrame.Visible then
            loadSecretCommands()
            updateStatus("‚ö° Firefly Commands UI ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß")
        else
            updateStatus("üîê ‡∏û‡∏¥‡∏°‡∏û‡πå !cmdfirefly ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î")
        end
        return
    end
    
    -- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
    if command == "tp" then
        local target = findPlayer(param)
        if target then
            startFollowing(target)
        else
            updateStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: " .. param)
        end
        
    elseif command == "tps" then
        stopFollowing()
        
    elseif command == "copy" then
        local target = findPlayer(param)
        if target then
            copyOutfit(target)
        else
            updateStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: " .. param)
        end
        
    elseif command == "firefly" then
        local count = tonumber(param) or 100
        spawnFireflies(count)
        
    elseif command == "goto" then
        local target = findPlayer(param)
        if target then
            teleportTo(target)
        else
            updateStatus("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: " .. param)
        end
        
    elseif command == "ns" then
        setFirefliesVisibility(false)
        
    elseif command == "s" then
        setFirefliesVisibility(true)
        
    elseif command == "fireflyclear" then
        clearFireflies()
        
    elseif command == "sa" then
        stopAll()
        
    else
        updateStatus("‚ùå ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å: !" .. command)
    end
end

-- ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏ä‡∏ó
player.Chatted:Connect(function(message)
    processChatCommand(message)
end)

-- ========== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ==========
loadSecretCommands()

-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
print("==================================================")
print("üî• Firefly Commands UI - FIXED VERSION")
print("")
print("‚úÖ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:")
print("  1. !tp - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß")
print("  2. !copy - ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏ä‡∏∏‡∏î‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß")
print("  3. !firefly - ‡πÄ‡∏™‡∏Å Firefly ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß")
print("  4. !ns/!s - ‡∏õ‡∏¥‡∏î/‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß")
print("  5. ‡∏•‡∏ö UI ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà")
print("")
print("‚ö° ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ:")
print("  !tp [‡∏ä‡∏∑‡πà‡∏≠]      - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (FIXED)")
print("  !tps           - ‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°")
print("  !copy [‡∏ä‡∏∑‡πà‡∏≠]    - ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏ä‡∏∏‡∏î (FIXED)")
print("  !firefly [‡∏à‡∏≥‡∏ô‡∏ß‡∏ô] - ‡πÄ‡∏™‡∏Å Firefly (FIXED)")
print("  !goto [‡∏ä‡∏∑‡πà‡∏≠]    - ‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏´‡∏≤")
print("  !ns           - ‡∏õ‡∏¥‡∏î‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô Firefly (FIXED)")
print("  !s            - ‡πÄ‡∏õ‡∏¥‡∏î‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô Firefly (FIXED)")
print("  !fireflyclear  - ‡∏•‡πâ‡∏≤‡∏á Firefly")
print("  !sa           - ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î")
print("")
print("üìå ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: !cmdfirefly ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î UI")
print("==================================================")

updateStatus("‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡∏û‡∏¥‡∏°‡∏û‡πå !cmdfirefly ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î UI")
